<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard | Stacks</title>
    <th:block th:replace="fragments/header.html :: main-header"/>
    <style>
        .progress-container:before {
            content: attr(data-text);
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            line-height: 1em;
        }

        .progress-container {
            text-align: center;
            position: relative;
        }

        .profile-container {
            margin: 1em 3em;
        }
    </style>
</head>
<body>
<th:block th:replace="fragments/navbar.html :: main-nav"/>
<section class="hero is-primary is-bold">
    <div class="hero-body">
        <div class="container" sec:authorize="isAuthenticated()">
            <h1 class="title">Welcome, <span th:text="${#authentication.principal.firstName}"></span>!</h1>
        </div>
    </div>
</section>

<div class="columns is-multiline is-half-mobile is-centered">
    <div class="column is-6">
        <div class="panel">
            <p class="panel-heading">Spending Habits</p>
            <div class="panel-block">
                <figure class="image is-16x9">
                    <canvas id="myChart"></canvas>
                </figure>
            </div>
        </div>
    </div>
    <div class="column is-6">
        <div class="panel">
            <p class="panel-heading">My Recent Transactions</p>
            <div class="panel-block">
                <div class="table-container">
                    <table class="table is-fullwidth is-bordered is-striped is-hoverable">
                        <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="expense : ${expenses}">
                            <td th:text="${expense.date}"></td>
                            <td th:text="${expense.description}"></td>
                            <th:block th:switch="${expense.type}">
                                <div th:case="1">
                                    <td>Bills</td>
                                </div>
                                <div th:case="2">
                                    <td>Groceries</td>
                                </div>
                                <div th:case="3">
                                    <td>Subscriptions & Memberships</td>
                                </div>
                                <div th:case="4">
                                    <td>Food & Dining</td>
                                </div>
                                <div th:case="5">
                                    <td>Leisure & Gifts</td>
                                </div>
                                <div th:case="6">
                                    <td>Auto & Transportation</td>
                                </div>
                                <div th:case="7">
                                    <td>Misc.</td>
                                </div>
                            </th:block>
                            <td>$<span th:text="${expense.amount}"></span></td>
                        </tbody>
                    </table>
<!--                    <a href="/profile/expenses/create">Recently made a purchase?</a>-->
                    <button class="button is-primary modal-button" data-target="#myModal" aria-haspopup="true">Made a purchase?</button>

                    <div class="modal" id="myModal">
                        <div class="modal-background"></div>
                        <div class="modal-content">
                            <div class="box">
                                    <div class="panel">
                                        <p class="panel-heading">Create an Expense</p>
                                        <div class="panel-block">
                                            <figure>
                                                <form th:action="@{/profile/expenses/create}" th:method="post" th:object="${expense}">
                                                    <div class="field">
                                                        <label class="label">Where was this purchase made?</label>
                                                        <div class="control has-icons-left">
                                                            <input th:field="*{description}" class="input" type="text">
                                                            <span class="icon is-small is-left"><i class="fas fa-building"></i></span>
                                                        </div>
                                                        <label class="label">How much was this purchase?</label>
                                                        <div class="control has-icons-left">
                                                            <input th:field="*{amount}" class="input" type="number" step=".01"
                                                                   placeholder="ex. 45.25, 176.97">
                                                            <span class="icon is-small is-left"><i class="fas fa-dollar-sign"></i></span>
                                                        </div>
                                                        <label class="label">When was this purchase made?</label>
                                                        <div class="control has-icons-left">
                                                            <input th:field="*{date}" class="input" type="date">
                                                            <span class="icon is-small is-left"><i class="fas fa-calendar-alt"></i></span>
                                                        </div>
                                                        <label for="type">Select the appropriate category for this purchase.</label>
                                                        <div class="control has-icons-left">
                                                            <select th:field="*{type}" id="type">
                                                                <option value="0" disabled selected>--Select One--</option>
                                                                <option value="1">Bills</option>
                                                                <option value="2">Groceries</option>
                                                                <option value="3">Subscriptions/Memberships</option>
                                                                <option value="4">Food & Dining</option>
                                                                <option value="5">Leisure & Gifts</option>
                                                                <option value="6">Auto/Transportation</option>
                                                                <option value="7">Misc</option>
                                                            </select>
                                                        </div>
                                                        <label for="isRegular">This is a reoccurring purchase.</label>
                                                        <input type="checkbox" name="isRegular" id="isRegular" value="true">
                                                    </div>
                                                    <div class="field is-grouped">
                                                        <div class="control">
                                                            <button class="button is-link is-rounded">Submit</button>
                                                        </div>
                                                        <div class="control">
                                                            <a class="button is-link is-rounded is-outlined" href="/profile/expenses">Cancel</a>
                                                        </div>
                                                    </div>
                                                </form>
                                            </figure>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <button class="modal-close is-large" aria-label="close"></button>
                    </div>
                    <br>
                    <a href="profile/expenses">View more transactions...</a>
                </div>
            </div>
        </div>
    </div>
<!--    <div class="column is-6 has-text-centered">-->
<!--        <div class="panel">-->
<!--            <p class="panel-heading">Create an Expense</p>-->
<!--            <div class="panel-block">-->
<!--                <figure>-->
<!--                    <form th:action="@{/profile/expenses/create}" th:method="post" th:object="${expense}">-->
<!--                        <div class="field">-->
<!--                            <label class="label">Where was this purchase made?</label>-->
<!--                            <div class="control has-icons-left">-->
<!--                                <input th:field="*{description}" class="input" type="text">-->
<!--                                <span class="icon is-small is-left"><i class="fas fa-building"></i></span>-->
<!--                            </div>-->
<!--                            <label class="label">How much was this purchase?</label>-->
<!--                            <div class="control has-icons-left">-->
<!--                                <input th:field="*{amount}" class="input" type="number" step=".01"-->
<!--                                       placeholder="ex. 45.25, 176.97">-->
<!--                                <span class="icon is-small is-left"><i class="fas fa-dollar-sign"></i></span>-->
<!--                            </div>-->
<!--                            <label class="label">When was this purchase made?</label>-->
<!--                            <div class="control has-icons-left">-->
<!--                                <input th:field="*{date}" class="input" type="date">-->
<!--                                <span class="icon is-small is-left"><i class="fas fa-calendar-alt"></i></span>-->
<!--                            </div>-->
<!--                            <label for="type">Select the appropriate category for this purchase.</label>-->
<!--                            <div class="control has-icons-left">-->
<!--                                <select th:field="*{type}" id="type">-->
<!--                                    <option value="0" disabled selected>&#45;&#45;Select One&#45;&#45;</option>-->
<!--                                    <option value="1">Bills</option>-->
<!--                                    <option value="2">Groceries</option>-->
<!--                                    <option value="3">Subscriptions/Memberships</option>-->
<!--                                    <option value="4">Food & Dining</option>-->
<!--                                    <option value="5">Leisure & Gifts</option>-->
<!--                                    <option value="6">Auto/Transportation</option>-->
<!--                                    <option value="7">Misc</option>-->
<!--                                </select>-->
<!--                            </div>-->
<!--                            <label for="isRegular">This is a reoccurring purchase.</label>-->
<!--                            <input type="checkbox" name="isRegular" id="isRegular" value="true">-->
<!--                        </div>-->
<!--                        <div class="field is-grouped">-->
<!--                            <div class="control">-->
<!--                                <button class="button is-link is-rounded">Submit</button>-->
<!--                            </div>-->
<!--                            <div class="control">-->
<!--                                <a class="button is-link is-rounded is-outlined" href="/profile/expenses">Cancel</a>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </form>-->
<!--                </figure>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>`-->
<!--    <div class="column is-6">-->
<!--        <div class="panel">-->
<!--            <p class="panel-heading">Detailed Spending</p>-->
<!--            <div class="panel-block">-->
<!--                <figure class="image is-16x9">-->
<!--                    <p> You have spent $<span th:text="${sum}"> so far this week<!doctype html></span></p>-->
<!--                </figure>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
    <div class="column is-6 has-text-centered">
        <div class="panel">
            <p class="panel-heading">My Current Goals</p>
            <div class="profile-goal" th:each="goal : ${goal}">
                <div style="height: 250px; width: 400px; margin-left: 10px; margin-top: 10px">
                    <h2 th:text="${goal.description}"></h2>
                    <div>
                        <ul>
                            <li><strong>Need to save: </strong>$<span th:text="${goal.amount}"></span></li>
                            <li><strong>How much you've saved so far: </strong>$<span
                                    th:text="${goal.amountSaved}"></span></li>
                            <li th:with="result=${goal.amount - goal.amountSaved}"><strong>What you have left to
                                go: </strong>$<span
                                    th:text="${result}"></span></li>
                        </ul>
                        <div class="progress-container" th:data-text="${goal.amount - goal.amountSaved}">
                            <progress class="progress is-success" th:max="${goal.amount}"
                                      th:value="${goal.amountSaved}"></progress>
                        </div>
                        <p><strong>Projected accomplishment date: </strong><br><span th:text="${goal.date}"
                                                                                     class="date-span"></span></p>
                        <div class="buttons">
                            <a class="button is-warning is-rounded"
                               th:href="@{'/goals/' + ${goal.id} + '/edit'}">Edit</a>
                            <form th:action="@{'/goals/' + ${goal.id} + '/delete'}" method="post">
                                <a class="button is-danger is-rounded">Delete</a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-block">
                <figure class="image is-16x9">
<!--                    <a class="button is-success is-rounded" href="/goals">Set a goal</a>-->
                    <button class="button is-primary mod2" data-target2="#myModal2" aria-haspopup="true">Set a Goal!?</button>
                    <div class="modal" id="myModal2">
                        <div class="modal-background"></div>
                        <div class="modal-content">
                            <div class="box">
                                <div class="column is-6 has-text-centered">
                                    <div class="panel">
                                        <p class="panel-heading">Create an Expense</p>
                                        <div class="panel-block">
                                            <figure>


                                            </figure>
                                        </div>
                                    </div>
                                </div>




                            </div>
                        </div>
                        <button class="modal-close is-large" aria-label="close"></button>
                    </div>



                    <br>
                    <a href="goals">View goals....</a>
                </figure>
            </div>
        </div>
    </div>
</div>
<th:block th:replace="fragments/footer.html :: pie-footer"/>
<th:block th:replace="fragments/footer.html :: main-footer"/>
<script>
document.querySelectorAll('.modal-button').forEach(function(el) {
el.addEventListener('click', function() {
var target = document.querySelector(el.getAttribute('data-target'));

target.classList.add('is-active');

target.querySelector('.modal-close').addEventListener('click',   function() {
target.classList.remove('is-active');
});
});
});


</script>
</body>
</html>
