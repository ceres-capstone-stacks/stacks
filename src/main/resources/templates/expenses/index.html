<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Expenses | Stacks</title>
    <th:block th:replace="fragments/header.html :: main-header"/>
</head>
<body>
<th:block th:replace="fragments/navbar.html :: main-nav"/>
<section class="hero is-primary is-bold">
    <div class="hero-body">
        <div class="container" sec:authorize="isAuthenticated()">
            <h1 class="title">Here are your transactions, <span th:text="${#authentication.principal.firstName}"></span>.
            </h1>
        </div>
    </div>
</section>
<div class="columns is-full-mobile is-centered">
<div class="column is-three-quarters">
    <a class="button is-link is-rounded is-outlined" href="expenses/create">Create a new expense</a>
    <table class="table is-striped is-bordered" style="width: 100%">
        <thead>
        <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="expense : ${expenses}">
            <td th:text="${expense.date }"></td>
            <td th:text="${expense.description}"></td>
            <th:block th:switch="${expense.type}">
                <div th:case="1">
                    <td>Bills</td>
                </div>
                <div th:case="2">
                    <td>Groceries</td>
                </div>
                <div th:case="3">
                    <td>Subscriptions & Memberships</td>
                </div>
                <div th:case="4">
                    <td>Food & Dining</td>
                </div>
                <div th:case="5">
                    <td>Leisure & Gifts</td>
                </div>
                <div th:case="6">
                    <td>Auto & Transportation</td>
                </div>
                <div th:case="7">
                    <td>Misc.</td>
                </div>
            </th:block>
            <td><span th:text="${#numbers.formatCurrency(expense.amount)}"></span></td>

            <td><div class="buttons"><a style="border-style: none" class="button" data-target="#myModal" aria-haspopup="true"><i class="far fa-edit"></i></a><!-- need to map the edit icon to the edit expense modal -->
            <form th:action="@{'/profile/expenses/' + ${expense.id} + '/delete'}" method="post">
                <button class="button" style="border-style: none"><i class="fas fa-trash-alt" style="color: red"></i></button>
            </form>
            </div>
            </td>
        </tbody>
    </table>
</div>
</div>
<div class="modal" id="myModal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <div class="box">
            <div class="panel">
                <p class="panel-heading">Edit this Expense</p>
                <div class="panel-block">
                    <figure>
                        <form th:action="'profile/expenses/' + ${expense.id} + '/edit'" th:method="post">
                            <div class="field">
                                <h1 th:text="${expense.description}"></h1>
                                <h5 class="subtitle is-6">Goal Amount: <span th:text="${#numbers.formatCurrency(expense.amount)}"></span></h5>
                            </div>
                            <div class="field">
                                <label class="label" for="date">Date</label>
                                <div class="control">
                                    <input class="input" id="date" th:value="${expense.date}" name="date" type="date">
                                </div>
                            </div>
                            <button id="save" class="button is-link is-rounded">Update</button>
                        </form>
                    </figure>
                </div>
            </div>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>

<th:block th:replace="fragments/footer :: main-footer"/>
<script>
    "use strict";
    $(document).ready(function() {
        document.querySelectorAll('.button').forEach(function (el) {
            el.addEventListener('click', function () {

                let target = document.querySelector(el.getAttribute('data-target'));
                target.classList.add('is-active');
                target.querySelector('.modal-close').addEventListener('click', function () {
                    target.classList.remove('is-active');
                });
            });
        });


    });
</script>
</body>
</html>